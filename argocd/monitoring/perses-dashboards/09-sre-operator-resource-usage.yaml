apiVersion: perses.dev/v1alpha1
kind: PersesDashboard
metadata:
  name: 26-sre-operator-resource-usage
  namespace: dash0-system
spec:
  duration: 30m
  display:
    description: ""
    name: SRE - Operator - resource usage
  layouts:
    - kind: Grid
      spec:
        items:
          - content:
              $ref: "#/spec/panels/c4ea356d-8795-4e0f-b5eb-a2036b054a02"
            height: 12
            width: 12
            x: 12
            "y": 3
          - content:
              $ref: "#/spec/panels/c4ea356d-8795-4e0f-b5eb-a2036b054a02-copy"
            height: 12
            width: 12
            x: 0
            "y": 3
          - content:
              $ref: "#/spec/panels/956d62ef-4e13-43e5-bc0a-53fd4511a02d"
            height: 3
            width: 24
            x: 0
            "y": 0
  panels:
    956d62ef-4e13-43e5-bc0a-53fd4511a02d:
      kind: Panel
      spec:
        display:
          description: ""
          name: Resource usage
        plugin:
          kind: Markdown
          spec:
            text: All pods running in "dash0-system" namespace
    c4ea356d-8795-4e0f-b5eb-a2036b054a02:
      kind: Panel
      spec:
        display:
          description: ""
          name: Memory usage
        plugin:
          kind: TimeSeriesChart
          spec:
            legend:
              mode: table
              position: right
              size: small
              values:
                - last
            thresholds: {}
            visual:
              areaOpacity: 0.55
              connectNulls: true
              display: line
              lineWidth: 1
              palette:
                mode: auto
              pointRadius: 2.5
              stack: none
            yAxis:
              format:
                decimalPlaces: 2
                enforceMinimumFractionDigits: false
                shortValues: true
                signDisplay: auto
                unit: bytes
              min: 0
              show: true
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: sum by (pod, cloud_region)
                    (rate(container_memory_usage_bytes{$cloud_region,
                    namespace="dash0-system"} [$__rate_interval]))
                  seriesNameFormat: "{{pod}} ({{cloud_region}})"
    c4ea356d-8795-4e0f-b5eb-a2036b054a02-copy:
      kind: Panel
      spec:
        display:
          description: ""
          name: CPU usage
        plugin:
          kind: TimeSeriesChart
          spec:
            legend:
              mode: table
              position: right
              size: small
              values:
                - last
            thresholds: {}
            visual:
              areaOpacity: 0.55
              connectNulls: true
              display: line
              lineWidth: 1
              palette:
                mode: auto
              pointRadius: 2.5
              stack: none
            yAxis:
              format:
                decimalPlaces: 0
                enforceMinimumFractionDigits: false
                shortValues: true
                signDisplay: auto
                unit: percent-decimal
              min: 0
              show: true
        queries:
          - kind: TimeSeriesQuery
            spec:
              plugin:
                kind: PrometheusTimeSeriesQuery
                spec:
                  query: sum by (pod, cloud_region)
                    (rate(container_cpu_usage_seconds_total{$cloud_region,
                    namespace="dash0-system"} [$__rate_interval]))
                  seriesNameFormat: "{{pod}} ({{cloud_region}})"
  variables:
    - kind: Dash0FilterVariable
      spec:
        attributeKey: cloud_region
        capturingRegexp: ""
        display:
          description: ""
          hidden: false
          name: ""
        name: cloud_region
        operator: is_not_set
        values: []
